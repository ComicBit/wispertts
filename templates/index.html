{% extends 'base.html' %}
{% block content %}
<h2 class="mb-4 text-center">Audio to Text</h2>
<form method="post" action="/start" enctype="multipart/form-data" class="row g-3">
  <div class="col-12">
    <input class="form-control" type="file" name="audio" required>
  </div>
  <div class="col-md-6">
    <label class="form-label">Language code</label>
    <input class="form-control" type="text" name="language" placeholder="auto">
  </div>
  <div class="col-md-6">
    <label class="form-label">Mode</label>
    <select class="form-select" name="mode" id="mode">
      <option value="api" selected>OpenAI API</option>
      {% if mlx_available %}
      <option value="mlx">MLX (Apple Silicon)</option>
      {% endif %}
      <option value="local">Local (openai-whisper)</option>
    </select>
  </div>

  <!-- Model selection for Local/MLX -->
  <div class="col-md-6" id="model-row">
    <label class="form-label">Model</label>
    <select class="form-select" name="local_model" id="local_model">
      <option value="tiny">tiny</option>
      <option value="tiny.en">tiny.en</option>
      <option value="base" selected>base</option>
      <option value="base.en">base.en</option>
      <option value="small">small</option>
      <option value="small.en">small.en</option>
      <option value="medium">medium</option>
      <option value="medium.en">medium.en</option>
      <option value="large-v3">large-v3</option>
    </select>
  </div>

  <!-- MLX-specific advanced options removed for simplicity -->

  <div class="col-12">
    <div class="form-check form-check-inline">
      <input class="form-check-input" type="checkbox" name="diarize" id="diarize">
      <label class="form-check-label" for="diarize">Speaker detection</label>
    </div>
    <div class="form-check form-check-inline">
      <input class="form-check-input" type="checkbox" name="aggregate" id="aggregate">
      <label class="form-check-label" for="aggregate">Aggregate lines</label>
    </div>
    <div class="form-check form-check-inline">
      <input class="form-check-input" type="checkbox" name="timestamps" id="timestamps">
      <label class="form-check-label" for="timestamps">Include timestamps</label>
    </div>
  </div>
  <div class="col-12 text-center">
    <button type="submit" class="btn btn-primary">Start</button>
  </div>
</form>

<script>
  const modeEl = document.getElementById('mode');
  const modelRow = document.getElementById('model-row');
  function syncMode() {
    const m = modeEl.value;
    const showModel = (m === 'local' || m === 'mlx');
    modelRow.style.display = showModel ? '' : 'none';
  }
  modeEl.addEventListener('change', syncMode);
  syncMode();
  </script>
{% endblock %}
